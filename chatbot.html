<!DOCTYPE html>
<html>
  <head>
    <title>React Basics</title>
  </head>
  <body>
    <!-- 
      This is the root container where the React application will be mounted.
      React will take over this <div> and render its content inside.
    -->
    <div class="js-container"></div>

    <!-- React and ReactDOM are the core libraries for building React applications. -->
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <!-- Babel is used to compile JSX (JavaScript XML) into standard JavaScript that browsers can understand. -->
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
      /**
       * ChatInput Component
       * Renders an input field and a send button for user interaction.
       */
      function ChatInput() {
        return (
          <div>
            <input
              type="text"
              placeholder="send a message to textbox"
              size="30"
            />
            <button>Send</button>
          </div>
        );
      }

      /**
       * ChatMessage Component
       * Renders a single chat message.
       *
       * @param {Object} props - The component props.
       * @param {string} props.message - The content of the message.
       * @param {string} props.sender - The sender of the message ('user' or 'robot').
       */
      function ChatMessage({ message, sender }) {
        // I am using destructuring in the function parameters to extract 'message' and 'sender' directly.
        // equivalent to:
        // const message = props.message;
        // const sender = props.sender;

        /*
         * Conditional Rendering approach:
         * I check the 'sender' prop to decide which image to display.
         * The logical AND operator (&&) is used ("Guard Operator") to conditionally render elements.
         * If the condition on the left is true, the element on the right is rendered.
         */
        return (
          <div>
            {sender === "robot" && (
              <img src="assets/robot.png" alt="Robot" width="50" />
            )}
            {message}
            {sender === "user" && (
              <img src="assets/user.png" alt="User" width="50" />
            )}
          </div>
        );
      }

      /**
       * ChatMessages Component
       * Renders a list of ChatMessage components based on an array of data.
       */
      function ChatMessages() {
        /*
          I use React.useState to create a stateful variable 'chatMessages'.
          - 'chatMessages': Holds the current array of message objects.
          - 'setChatMessages': A function to update the 'chatMessages' state.
          Initial state is an array of default messages.
        */
        const array = React.useState([
          {
            message: "Hello chatbot",
            sender: "user",
            key: "id-1",
          },
          {
            message: "Hello! How can i help you",
            sender: "robot",
            key: "id-2",
          },
          {
            message: "can you get me todays date?",
            sender: "user",
            key: "id-3",
          },
          {
            message: "Today is September 27",
            sender: "robot",
            key: "id-4",
          },
          {
            message: "how about flip a coin",
            sender: "user",
            key: "id-5",
          },
          {
            message: "Sure! You got tails",
            sender: "robot",
            key: "id-6",
          },
        ]);
        const chatMessages = array[0];
        const setChatMessages = array[1];

        /**
         * Function to add a new message to the chat.
         * I use the spread operator (...) to copy the existing messages and add the new one.
         * crypto.randomUUID() generates a unique ID for the key prop.
         */
        function sendMessage() {
          setChatMessages([
            ...chatMessages,
            {
              message: "test",
              sender: "user",
              key: crypto.randomUUID(), // Generates a unique string ID
            },
          ]);
        }

        return (
          <div>
            {/* The onClick event handler calls the sendMessage function when the button is clicked. */}
            <button onClick={sendMessage}>Send message</button>
            {/*
              I use the .map() method to iterate over the 'chatMessages' array
              and transform each object into a <ChatMessage /> component.
              The 'key' prop is essential for React to efficiently update the list.
            */}
            {chatMessages.map((chatMessage) => {
              return (
                <ChatMessage
                  message={chatMessage.message}
                  sender={chatMessage.sender}
                  key={chatMessage.key}
                />
              );
            })}
          </div>
        );
      }

      /**
       * App Component
       * The main component that serves as the entry point for the application structure.
       */
      function App() {
        return (
          <div>
            <ChatInput />
            <ChatMessages />
          </div>
        );
      }

      // Select the HTML container element
      const container = document.querySelector(".js-container");

      // Create a React root for the container and render the App component
      ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>
